{"version":3,"sources":["../../src/datasource.js"],"names":["GenericDatasource","instanceSettings","$q","backendSrv","templateSrv","type","basePath","url","name","jsonData","q","default_period","acs_ecs_dashboard","acs_rds_dashboard","acs_slb_dashboard","acs_memcache","acs_ocs","acs_vpc_eip","acs_kvstore","acs_mns_new","acs_cdn","acs_ads","acs_mongodb","acs_express_connect","acs_fc","acs_nat_gateway","options","console","log","paramPattern","start","Date","range","from","getTime","end","to","queries","targets","forEach","target","project","metric","query","Project","Metric","period","loadDefaultPeroid","Period","StartTime","EndTime","dimension","_","each","dimensions","dim","value","key","Dimensions","JSON","stringify","keys","replace","uriEscape","param","path","method","push","buildRealUrl","isEmpty","d","defer","resolve","data","promise","allQueryPromise","map","headers","datasourceRequest","bind","all","then","allResponse","result","response","index","selectedFieldNames","resResult","datapoints","Datapoints","parse","datapoint","Datapoint","selectedFieldName","timestamp","concat","string","output","encodeURIComponent","escape","ch","charCodeAt","toString","toUpperCase","Resources","Resource","parameters","undefined","Code","dimList","NextKey","status","message","title","items","match","dimensionValues","split","i","pm","indexOf","arr","dimensionKeys","filter","j","k","now","mapToTextValue","text","isObject","signer","CmsSigner","accessKeyId","cmsAccessKey","secretAccessKey","cmsSecretKey","addAuthorization","request"],"mappings":"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","file":"datasource.js","sourcesContent":["import _ from \"lodash\";\nimport { CmsSigner } from \"./signer\";\n\nexport class GenericDatasource {\n\n\tconstructor(instanceSettings, $q, backendSrv, templateSrv) {\n\t\tthis.type = instanceSettings.type;\n\t\tthis.basePath = instanceSettings.url;\n\t\tthis.name = instanceSettings.name;\n\t\tthis.jsonData = instanceSettings.jsonData;\n\t\tthis.q = $q;\n\t\tthis.backendSrv = backendSrv;\n\t\tthis.templateSrv = templateSrv;\n\t\tthis.default_period = {\n\t\t\tacs_ecs_dashboard: '60',\n\t\t\tacs_rds_dashboard: '300',\n\t\t\tacs_slb_dashboard: '60',\n\t\t\tacs_memcache: '60',\n\t\t\tacs_ocs: '60',\n\t\t\tacs_vpc_eip: '60',\n\t\t\tacs_kvstore: '60',\n\t\t\tacs_mns_new: '300',\n\t\t\tacs_cdn: '60',\n\t\t\tacs_ads: '300',\n\t\t\tacs_mongodb: '300',\n\t\t\tacs_express_connect: '60',\n\t\t\tacs_fc: '60',\n\t\t\tacs_nat_gateway: '60'\n\t\t};\n\t}\n\n\tquery(options) {\n\t\tconsole.log(\"hello\", options)\n\t\tvar paramPattern = \"/?Action=QueryMetricList&Project={Project}&Metric={Metric}&Period={Period}&\" +\n\t\t\t\"StartTime={StartTime}&EndTime={EndTime}&Dimensions={Dimensions}&Length=1000\";\n\t\tvar start = new Date(options.range.from).getTime();\n\t\tvar end = new Date(options.range.to).getTime();\n\t\tvar queries = [];\n\t\t_(options.targets).forEach(target => {\n\t\t\tif(!target.project && target.project === '' && !target.metric && target.metric === '') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar query = {};\n\t\t\tquery.Project = target.project;\n\t\t\tquery.Metric = target.metric;\n\t\t\tvar period = target.period;\n\t\t\tif(period && period > 0 && period % this.loadDefaultPeroid(target.project, target.metric) === 0) {\n\t\t\t\tquery.Period = period;\n\t\t\t} else {\n\t\t\t\tquery.Period = '';\n\t\t\t}\n\t\t\tquery.StartTime = start;\n\t\t\tquery.EndTime = end;\n\n\t\t\tvar dimension = {};\n\t\t\t_.each(target.dimensions, function(dim) {\n\t\t\t\tif(dim.value && dim.value !== '') {\n\t\t\t\t\t//dimension[dim.key] = this.templateSrv.replace(dim.value);\n\t\t\t\t\tdimension[dim.key] = dim.value;\n\t\t\t\t}\n\t\t\t});\n\t\t\tquery.Dimensions = JSON.stringify(dimension);\n\n\t\t\t_.each(_.keys(query), key => {\n\t\t\t\tparamPattern = paramPattern.replace('{' + key + '}', this.uriEscape(query[key]));\n\t\t\t});\n\n\t\t\tvar param = {\n\t\t\t\tpath: paramPattern,\n\t\t\t\tmethod: \"GET\"\n\t\t\t};\n\t\t\tqueries.push(this.buildRealUrl(param));\n\t\t});\n\n\t\tif(_.isEmpty(queries)) {\n\t\t\tvar d = this.q.defer();\n\t\t\td.resolve({\n\t\t\t\tdata: []\n\t\t\t});\n\t\t\treturn d.promise;\n\t\t}\n\n\t\tvar allQueryPromise = _.map(queries, function(query) {\n\t\t\tvar options = {\n\t\t\t\tmethod: 'GET',\n\t\t\t\turl: query,\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn this.backendSrv.datasourceRequest(options);\n\t\t}.bind(this));\n\n\t\treturn this.q.all(allQueryPromise).then(function(allResponse) {\n\t\t\tvar result = [];\n\t\t\t_.each(allResponse, function(response, index) {\n\t\t\t\tvar target = options.targets[index];\n\t\t\t\tvar selectedFieldNames = target.selectedFieldNames;\n\t\t\t\tvar resResult = [];\n\t\t\t\t_.each(selectedFieldNames, selectedFieldName => {\n\t\t\t\t\tvar datapoints = [];\n\t\t\t\t\tvar Datapoints = JSON.parse(response.data.Datapoints);\n\t\t\t\t\t_.each(Datapoints, Datapoint => {\n\t\t\t\t\t\tlet datapoint = [];\n\t\t\t\t\t\tdatapoint.push(Datapoint[selectedFieldName], Datapoint.timestamp);\n\t\t\t\t\t\tdatapoints.push(datapoint);\n\t\t\t\t\t});\n\t\t\t\t\tresResult.push({\n\t\t\t\t\t\t\"target\": selectedFieldName,\n\t\t\t\t\t\t\"datapoints\": datapoints\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tresult = result.concat(typeof resResult == 'string' ? JSON.parse(resResult) : resResult);\n\t\t\t});\n\t\t\treturn {\n\t\t\t\tdata: result\n\t\t\t};\n\t\t});\n\t}\n\n\turiEscape(string) {\n\t\tvar output = encodeURIComponent(string);\n\t\toutput = output.replace(/[^A-Za-z0-9_.~\\-%]+/g, escape);\n\t\toutput = output.replace(/[*]/g, function(ch) {\n\t\t\treturn '%' + ch.charCodeAt(0).toString(16).toUpperCase();\n\t\t});\n\t\treturn output;\n\t}\n\n\tListProjectDetail() {\n\t\tvar param = {\n\t\t\tpath: \"/?Action=QueryProjectMeta&PageSize=1000\",\n\t\t\tmethod: \"GET\"\n\t\t};\n\t\treturn this.backendSrv.datasourceRequest({\n\t\t\turl: this.buildRealUrl(param),\n\t\t\tmethod: 'GET'\n\t\t}).then(response => {\n\t\t\tvar data = response.data;\n\t\t\tvar result = [];\n\t\t\t_.each(data.Resources.Resource, Resource => {\n\t\t\t\tresult.push(Resource.Project);\n\t\t\t});\n\t\t\treturn result;\n\t\t});\n\t}\n\n\tListMetricDetail(parameters) {\n\t\tvar paramPattern = \"/?Action=QueryMetricMeta&Project={Project}&Metric={Metric}&PageSize=1000\";\n\t\t_.each(_.keys(parameters), key => {\n\t\t\tparamPattern = paramPattern.replace('{' + key + '}', this.uriEscape(parameters[key]));\n\t\t});\n\t\tvar param = {\n\t\t\tpath: paramPattern,\n\t\t\tmethod: \"GET\"\n\t\t};\n\t\treturn this.backendSrv.datasourceRequest({\n\t\t\turl: this.buildRealUrl(param),\n\t\t\tmethod: 'GET',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json'\n\t\t\t}\n\t\t});\n\t}\n\n\t//\tgetGroupList() {\n\t//\t\tvar param = {\n\t//\t\t\tpath: \"/?Action=ListMyGroups\",\n\t//\t\t\tmethod: \"GET\"\n\t//\t\t};\n\t//\t\treturn this.backendSrv.datasourceRequest({\n\t//\t\t\turl: this.buildRealUrl(param),\n\t//\t\t\tmethod: 'GET'\n\t//\t\t}).then(response => {\n\t//\t\t\tvar data = response.data;\n\t//\t\t\tvar result = [];\n\t//\t\t\t_.each(data.Resources.Resource, Group => {\n\t//\t\t\t\tlet group = [];\n\t//\t\t\t\tgroup.push(Group.GroupName, Group.GroupId);\n\t//\t\t\t\tresult.push(group.join(\"/\"));\n\t//\t\t\t});\n\t//\t\t\treturn result;\n\t//\t\t});\n\t//\t}\n\n\tlistDimensionValues(query) {\n\t\tvar paramPattern = \"/?Action=QueryMetricLast&Project={Project}&Metric={Metric}&Period={Period}&\" +\n\t\t\t\"StartTime={StartTime}&EndTime={EndTime}&Dimensions={Dimensions}\";\n\t\tvar dimensions = {};\n\t\tfor(var index in query.Dimensions) {\n\t\t\tvar dim = query.Dimensions[index];\n\t\t\tif(dim.value && dim.value !== '') {\n\t\t\t\tdimensions[dim.key] = this.templateSrv.replace(dim.value);\n\t\t\t}\n\t\t}\n\t\tquery.Dimensions = JSON.stringify(dimensions);\n\t\tif(!query.Period || query.Period === '') {\n\t\t\tif(this.loadDefaultPeroid(query.Project, query.Metric) === undefined) {\n\t\t\t\tquery.Period = '';\n\t\t\t} else {\n\t\t\t\tquery.Period = this.loadDefaultPeroid(query.Project, query.Metric);\n\t\t\t}\n\t\t}\n\t\t_.each(_.keys(query), key => {\n\t\t\tparamPattern = paramPattern.replace('{' + key + '}', this.uriEscape(query[key]));\n\t\t});\n\t\tvar param = {\n\t\t\tpath: paramPattern,\n\t\t\tmethod: \"GET\"\n\t\t};\n\t\treturn this.backendSrv.datasourceRequest({\n\t\t\turl: this.buildRealUrl(param),\n\t\t\tmethod: 'GET',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json'\n\t\t\t}\n\t\t}).then(response => {\n\t\t\tvar data = response.data;\n\t\t\tif(data.Code == 200) {\n\t\t\t\tlet dimList = [];\n\t\t\t\tvar Datapoints = JSON.parse(response.data.Datapoints);\n\t\t\t\t_.each(Datapoints, Datapoint => {\n\t\t\t\t\tdimList.push(Datapoint[query.NextKey]);\n\t\t\t\t});\n\t\t\t\treturn {\n\t\t\t\t\tdata: dimList\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t}\n\n\ttestDatasource() {\n\t\tvar param = {\n\t\t\tpath: \"/?Action=QueryMetricList&Project=acs_ecs_dashboard&Metric=cpu_idle&Length=1\",\n\t\t\tmethod: \"GET\"\n\t\t};\n\t\treturn this.backendSrv.datasourceRequest({\n\t\t\turl: this.buildRealUrl(param),\n\t\t\tmethod: 'GET'\n\t\t}).then(response => {\n\t\t\tvar data = response.data;\n\t\t\tif(data.Code == 200) {\n\t\t\t\treturn {\n\t\t\t\t\tstatus: \"success\",\n\t\t\t\t\tmessage: \"Data source is working\",\n\t\t\t\t\ttitle: \"Success\"\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t}\n\n\tmetricFindQuery(query) {\n\t\tvar paramPattern = \"/?Action=QueryMetricLast&Project={Project}&Metric={Metric}&Period={Period}&\" +\n\t\t\t\"StartTime={StartTime}&EndTime={EndTime}&Dimensions={Dimensions}\";\n\t\tvar items = query.match(/^dimension_values\\((.*)\\)/);\n\t\tvar dimensionValues = [];\n\t\t_.each(items[1].split(\",\"), i => {\n\t\t\tdimensionValues.push(i.match(/\"(.*)\"/)[1]);\n\t\t});\n\t\tvar pm = dimensionValues[0];\n\t\tif(!pm || pm.indexOf('/') === -1) {\n\t\t\treturn;\n\t\t}\n\t\tvar arr = pm.split(\"/\");\n\t\tvar dimensionKeys = _.filter([\"userId\", \"instanceId\"], key => {\n\t\t\treturn key !== 'userId';\n\t\t});\n\t\tvar dimension = {};\n\t\tvar j = 1;\n\t\tfor(var k in dimensionKeys) {\n\t\t\tvar key = dimensionKeys[k];\n\t\t\tif(dimensionValues[j]) {\n\t\t\t\tdimension[key] = this.templateSrv.replace(dimensionValues[j]);\n\t\t\t\tj++;\n\t\t\t}\n\t\t}\n\t\tif(!dimensionKeys[j - 1]) {\n\t\t\treturn [];\n\t\t}\n\t\tvar param = {};\n\t\tparam.Project = arr[0];\n\t\tparam.Metric = arr[1];\n\t\tparam.Period = this.loadDefaultPeroid(arr[0], arr[1]);\n\t\tvar now = new Date();\n\t\tparam.StartTime = now.getTime() - 1000 * 60 * 60;\n\t\tparam.EndTime = now.getTime();\n\t\tparam.Dimensions = JSON.stringify(dimension);\n\t\t_.each(_.keys(param), key => {\n\t\t\tparamPattern = paramPattern.replace('{' + key + '}', this.uriEscape(param[key]));\n\t\t});\n\t\tvar param = {\n\t\t\tpath: paramPattern,\n\t\t\tmethod: \"GET\"\n\t\t};\n\n\t\treturn this.backendSrv.datasourceRequest({\n\t\t\turl: this.buildRealUrl(param),\n\t\t\tmethod: 'GET',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json'\n\t\t\t}\n\t\t}).then(response => {\n\t\t\tvar data = response.data;\n\t\t\tif(data.Code == 200) {\n\t\t\t\tlet dimList = [];\n\t\t\t\t_.each(response.data.Datapoints, Datapoint => {\n\t\t\t\t\tdimList.push(Datapoint[dimensionKeys[j - 1]]);\n\t\t\t\t});\n\t\t\t\treturn this.mapToTextValue(dimList);\n\t\t\t}\n\t\t});\n\t}\n\n\tmapToTextValue(result) {\n\t\treturn _.map(result, (d, i) => {\n\t\t\tif(d && d.text && d.value) {\n\t\t\t\treturn {\n\t\t\t\t\ttext: d.text,\n\t\t\t\t\tvalue: d.value\n\t\t\t\t};\n\t\t\t} else if(_.isObject(d)) {\n\t\t\t\treturn {\n\t\t\t\t\ttext: d,\n\t\t\t\t\tvalue: i\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn {\n\t\t\t\ttext: d,\n\t\t\t\tvalue: d\n\t\t\t};\n\t\t});\n\t}\n\n\tloadDefaultPeroid(project, metric) {\n\t\tif(project === 'acs_ecs_dashboard' &&\n\t\t\tmetric.indexOf('_') > 0 &&\n\t\t\tmetric.indexOf('InternetOutRate') === -1 &&\n\t\t\tmetric.indexOf('VPC') === -1) {\n\t\t\treturn '15';\n\t\t} else {\n\t\t\treturn this.default_period[project];\n\t\t}\n\t}\n\n\tbuildRealUrl(param) {\n\t\tvar signer = new CmsSigner({\n\t\t\taccessKeyId: this.jsonData.cmsAccessKey,\n\t\t\tsecretAccessKey: this.jsonData.cmsSecretKey\n\t\t}, param);\n\t\tsigner.addAuthorization();\n\t\treturn this.basePath + signer.request.path;\n\t}\n}"]}